
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/resources/myassembler.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f4ee9QBS+NLeogXatIXQMy2', 'myassembler');
// resources/myassembler.ts

Object.defineProperty(exports, "__esModule", { value: true });
/**
 * 支持原生端自定义渲染
 */
var gfx = cc.gfx;
var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
var vfmtPosUvColor = new gfx.VertexFormat([
    { name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },
    { name: gfx.ATTR_UV0, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },
    { name: gfx.ATTR_COLOR, type: gfx.ATTR_TYPE_UINT8, num: 4, normalize: true },
]);
var myassembler = /** @class */ (function (_super) {
    __extends(myassembler, _super);
    function myassembler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.verts = [];
        _this.quads = [];
        _this.verticesCount = 4;
        _this.indicesCount = 6;
        _this.floatsPerVert = 5;
        _this.renderData = null;
        return _this;
    }
    myassembler.prototype.init = function (comp) {
        _super.prototype.init.call(this, comp);
        //@ts-ignore
        var segmentCount = comp.getVertNum() - 1;
        this.verticesCount = 4 * segmentCount;
        this.indicesCount = 6 * segmentCount;
        // this.floatsPerVert = 6;
        this.initData();
    };
    myassembler.prototype.initData = function () {
        //@ts-ignore
        this.renderData = new cc.RenderData();
        this.renderData.init(this);
        var data = this.renderData;
        // createFlexData支持创建指定格式的renderData
        data.createFlexData(0, this.verticesCount, this.indicesCount, vfmtPosUvColor);
        // 顶点数固定的情况下索引不变化
        var indices = data.iDatas[0];
        var count = indices.length / 6;
        for (var i = 0, idx = 0; i < count; i++) {
            var vertextID = i * 4;
            indices[idx++] = vertextID;
            indices[idx++] = vertextID + 1;
            indices[idx++] = vertextID + 2;
            indices[idx++] = vertextID + 1;
            indices[idx++] = vertextID + 3;
            indices[idx++] = vertextID + 2;
        }
    };
    myassembler.prototype.updateRenderData = function (comp) {
        if (comp) {
            var pointNum = comp.getVertNum();
            var spaceCnt = pointNum - 1;
            this.verts.length = 0;
            this.quads.length = 0;
            var node = comp.node;
            var height = node.height;
            var width = node.width;
            // 上一个点的纹理坐标
            var lastU = 0;
            // 下一个点的纹理坐标
            var nextU = 0;
            //坐标
            var spaceX = width / spaceCnt;
            var spaceUv = 1 / spaceCnt;
            // 左下角的坐标
            var posX = -width * node.anchorX;
            var posY = -height * node.anchorY;
            if (!cc.sys.isNative) {
                var worldPos = comp.node.convertToWorldSpaceAR(cc.v2(posX, posY));
                posX = worldPos.x;
                posY = worldPos.y;
            }
            for (var i = 1; i < pointNum; i++) {
                nextU = lastU + spaceUv;
                var lb = this.verts.push({ x: posX + (i - 1) * spaceX, y: posY, u: lastU, v: 1 });
                var rb = this.verts.push({ x: posX + i * spaceX, y: posY, u: nextU, v: 1 });
                var lt = this.verts.push({ x: posX + (i - 1) * spaceX, y: posY + height, u: lastU, v: 0 });
                var rt = this.verts.push({ x: posX + i * spaceX, y: posY + height, u: nextU, v: 0 });
                this.quads.push({
                    lb: lb - 1,
                    rb: rb - 1,
                    lt: lt - 1,
                    rt: rt - 1,
                });
                lastU = nextU;
            }
            if (cc.sys.isNative) {
                var white = comp.node.color._val;
                var vertexOffset = 0;
                // 填充顶点缓冲
                var vbuf = this.renderData.vDatas[0];
                for (var i = 0, len = this.verts.length; i < len; i++) {
                    var vert = this.verts[i];
                    vbuf[vertexOffset++] = vert.x;
                    vbuf[vertexOffset++] = vert.y;
                    vbuf[vertexOffset++] = vert.u;
                    vbuf[vertexOffset++] = vert.v;
                    vbuf[vertexOffset++] = white;
                    // vertexOffset++;
                    // vbuf[vertexOffset++] = isFront;
                }
            }
            // let white = cc.Color.RED._val 
        }
    };
    myassembler.prototype.fillBuffers = function (comp, renderer) {
        if (this.verts.length == 0) {
            return;
        }
        var buffer = renderer.getBuffer('mesh', vfmtPosUvColor);
        var verts = this.verts;
        var vertexCount = verts.length;
        var indiceCount = this.quads.length * 6;
        // 通过设定的顶点数量及顶点索引数量获取 buffer 的数据空间
        var offsetInfo = buffer.request(vertexCount, indiceCount);
        var vbuf = buffer._vData; //positon/uv
        var ibuf = buffer._iData; //index 
        var uintbuf = buffer._uintVData; // colors
        var vertexOffset = offsetInfo.byteOffset >> 2;
        var indiceOffset = offsetInfo.indiceOffset;
        var vertexId = offsetInfo.vertexOffset;
        var white = cc.Color.WHITE._val;
        // 填充顶点缓冲
        for (var i = 0, len = verts.length; i < len; i++) {
            var vert = verts[i];
            // let isFirstVert = i % 2 === 0
            // let firstVert = isFirstVert ? vert : verts[i - 1]
            // let secondVert = isFirstVert ? verts[i + 1] : vert
            // // 计算当前小矩形是正面还是背面
            // let isFront = firstVert.x < secondVert.x ? 1.0 : 0.0
            vbuf[vertexOffset++] = vert.x;
            vbuf[vertexOffset++] = vert.y;
            vbuf[vertexOffset++] = vert.u;
            vbuf[vertexOffset++] = vert.v;
            uintbuf[vertexOffset++] = white;
            // vbuf[vertexOffset++] = isFront;
        }
        // 填充索引缓冲
        for (var i = 0, len = this.quads.length; i < len; i++) {
            var quad = this.quads[i];
            ibuf[indiceOffset++] = vertexId + quad.lb;
            ibuf[indiceOffset++] = vertexId + quad.rb;
            ibuf[indiceOffset++] = vertexId + quad.lt;
            ibuf[indiceOffset++] = vertexId + quad.rb;
            ibuf[indiceOffset++] = vertexId + quad.rt;
            ibuf[indiceOffset++] = vertexId + quad.lt;
        }
    };
    myassembler = __decorate([
        ccclass
    ], myassembler);
    return myassembler;
}(cc.Assembler));
exports.default = myassembler;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xccmVzb3VyY2VzXFxteWFzc2VtYmxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0dBRUc7QUFDSCxJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDO0FBQ2IsSUFBQSxLQUFzQixFQUFFLENBQUMsVUFBVSxFQUFsQyxPQUFPLGFBQUEsRUFBRSxRQUFRLGNBQWlCLENBQUM7QUFFMUMsSUFBSSxjQUFjLEdBQUcsSUFBSSxHQUFHLENBQUMsWUFBWSxDQUFDO0lBQ3RDLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFO0lBQ2hFLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFO0lBQzNELEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO0NBQy9FLENBQUMsQ0FBQztBQWlCSDtJQUF5QywrQkFBWTtJQUFyRDtRQUFBLHFFQXlKQztRQXhKYSxXQUFLLEdBQWdCLEVBQUUsQ0FBQTtRQUN2QixXQUFLLEdBQWMsRUFBRSxDQUFBO1FBQ3ZCLG1CQUFhLEdBQVUsQ0FBQyxDQUFDO1FBQ3pCLGtCQUFZLEdBQVUsQ0FBQyxDQUFDO1FBQ3hCLG1CQUFhLEdBQVUsQ0FBQyxDQUFDO1FBQ3ZCLGdCQUFVLEdBQWtCLElBQUksQ0FBQzs7SUFtSi9DLENBQUM7SUFqSlUsMEJBQUksR0FBWCxVQUFZLElBQXdCO1FBQ2hDLGlCQUFNLElBQUksWUFBQyxJQUFJLENBQUMsQ0FBQztRQUVqQixZQUFZO1FBQ1osSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLFVBQVUs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QUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2xFLElBQUksR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNsQixJQUFJLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQzthQUNyQjtZQUNELEtBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLEVBQUUsQ0FBQyxFQUFHLEVBQUM7Z0JBQzlCLEtBQUssR0FBRyxLQUFLLEdBQUcsT0FBTyxDQUFDO2dCQUN4QixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDakYsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsSUFBSSxHQUFHLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUMzRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxFQUFHLENBQUMsRUFBRSxJQUFJLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQzNGLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsQ0FBQyxFQUFFLElBQUksR0FBRyxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRXBGLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO29CQUNaLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQztvQkFDVixFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUM7b0JBQ1YsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDO29CQUNWLEVBQUUsRUFBRyxFQUFFLEdBQUcsQ0FBQztpQkFDZCxDQUFDLENBQUE7Z0JBQ0YsS0FBSyxHQUFHLEtBQUssQ0FBQzthQUNqQjtZQUNELElBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUM7Z0JBQ2YsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO2dCQUNqQyxJQUFJLFlBQVksR0FBRyxDQUFDLENBQUM7Z0JBQ3JCLFNBQVM7Z0JBQ1QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUNuRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUN4QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUM5QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUM5QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUM5QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUM5QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUM7b0JBQzdCLGtCQUFrQjtvQkFDbEIsa0NBQWtDO2lCQUNyQzthQUNKO1lBQ0QsaUNBQWlDO1NBRXBDO0lBQ0wsQ0FBQztJQUVNLGlDQUFXLEdBQWxCLFVBQW1CLElBQXVCLEVBQUUsUUFBb0I7UUFDNUQsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxDQUFDLEVBQUU7WUFDeEIsT0FBTTtTQUNUO1FBQ0QsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsY0FBYyxDQUFDLENBQUE7UUFFdkQsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUN0QixJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFBO1FBQzlCLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQTtRQUN2QyxrQ0FBa0M7UUFDbEMsSUFBSSxVQUFVLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFMUQsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQSxDQUFDLFlBQVk7UUFDckMsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQSxDQUFDLFFBQVE7UUFDakMsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQSxDQUFDLFNBQVM7UUFFekMsSUFBSSxZQUFZLEdBQUcsVUFBVSxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUE7UUFDN0MsSUFBSSxZQUFZLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQTtRQUMxQyxJQUFJLFFBQVEsR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFBO1FBQ3RDLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQTtRQUMvQixTQUFTO1FBQ1QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM5QyxJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDbkIsZ0NBQWdDO1lBQ2hDLG9EQUFvRDtZQUNwRCxxREFBcUQ7WUFDckQsb0JBQW9CO1lBQ3BCLHVEQUF1RDtZQUN2RCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUNoQyxrQ0FBa0M7U0FDckM7UUFDRCxTQUFTO1FBQ1QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDbkQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUN4QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtZQUN6QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtZQUN6QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtZQUV6QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtZQUN6QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtZQUN6QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtTQUM1QztJQUNMLENBQUM7SUF4SmdCLFdBQVc7UUFEL0IsT0FBTztPQUNhLFdBQVcsQ0F5Si9CO0lBQUQsa0JBQUM7Q0F6SkQsQUF5SkMsQ0F6SndDLEVBQUUsQ0FBQyxTQUFTLEdBeUpwRDtrQkF6Sm9CLFdBQVciLCJmaWxlIjoiIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog5pSv5oyB5Y6f55Sf56uv6Ieq5a6a5LmJ5riy5p+TXHJcbiAqL1xyXG5jb25zdCBnZnggPSBjYy5nZng7XHJcbmNvbnN0IHtjY2NsYXNzLCBwcm9wZXJ0eX0gPSBjYy5fZGVjb3JhdG9yO1xyXG5cclxubGV0IHZmbXRQb3NVdkNvbG9yID0gbmV3IGdmeC5WZXJ0ZXhGb3JtYXQoW1xyXG4gICAgeyBuYW1lOiBnZnguQVRUUl9QT1NJVElPTiwgdHlwZTogZ2Z4LkFUVFJfVFlQRV9GTE9BVDMyLCBudW06IDIgfSxcclxuICAgIHsgbmFtZTogZ2Z4LkFUVFJfVVYwLCB0eXBlOiBnZnguQVRUUl9UWVBFX0ZMT0FUMzIsIG51bTogMiB9LFxyXG4gICAgeyBuYW1lOiBnZnguQVRUUl9DT0xPUiwgdHlwZTogZ2Z4LkFUVFJfVFlQRV9VSU5UOCwgbnVtOiA0LCBub3JtYWxpemU6IHRydWUgfSxcclxuXSk7XHJcblxyXG5pbnRlcmZhY2UgQm9va1ZlcnRleCB7XHJcbiAgICB4Om51bWJlcixcclxuICAgIHk6bnVtYmVyLFxyXG4gICAgdTpudW1iZXIsXHJcbiAgICB2Om51bWJlclxyXG59XHJcblxyXG5pbnRlcmZhY2UgQm9va1F1YWQge1xyXG4gICAgbHQ6bnVtYmVyLFxyXG4gICAgbGI6bnVtYmVyLFxyXG4gICAgcmI6bnVtYmVyLFxyXG4gICAgcnQ6bnVtYmVyXHJcbn1cclxuXHJcbkBjY2NsYXNzXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIG15YXNzZW1ibGVyIGV4dGVuZHMgY2MuQXNzZW1ibGVyIHtcclxuICAgIHByb3RlY3RlZCB2ZXJ0czpCb29rVmVydGV4W10gPSBbXVxyXG4gICAgcHJvdGVjdGVkIHF1YWRzOkJvb2tRdWFkW10gPSBbXVxyXG4gICAgcHJpdmF0ZSB2ZXJ0aWNlc0NvdW50Om51bWJlciA9IDQ7XHJcbiAgICBwcml2YXRlIGluZGljZXNDb3VudDpudW1iZXIgPSA2O1xyXG4gICAgcHJpdmF0ZSBmbG9hdHNQZXJWZXJ0Om51bWJlciA9IDU7XHJcbiAgICBwcm90ZWN0ZWQgcmVuZGVyRGF0YTogY2MuUmVuZGVyRGF0YSA9IG51bGw7XHJcblxyXG4gICAgcHVibGljIGluaXQoY29tcDogY2MuUmVuZGVyQ29tcG9uZW50KSB7XHJcbiAgICAgICAgc3VwZXIuaW5pdChjb21wKTtcclxuXHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgbGV0IHNlZ21lbnRDb3VudCA9IGNvbXAuZ2V0VmVydE51bSgpIC0gMTtcclxuICAgICAgICB0aGlzLnZlcnRpY2VzQ291bnQgPSA0ICogc2VnbWVudENvdW50O1xyXG4gICAgICAgIHRoaXMuaW5kaWNlc0NvdW50ID0gNiAqIHNlZ21lbnRDb3VudDtcclxuICAgICAgICAvLyB0aGlzLmZsb2F0c1BlclZlcnQgPSA2O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuaW5pdERhdGEoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaW5pdERhdGEoKSB7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgdGhpcy5yZW5kZXJEYXRhID0gbmV3IGNjLlJlbmRlckRhdGEoKTtcclxuICAgICAgICB0aGlzLnJlbmRlckRhdGEuaW5pdCh0aGlzKTtcclxuXHJcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLnJlbmRlckRhdGE7XHJcbiAgICAgICAgLy8gY3JlYXRlRmxleERhdGHmlK/mjIHliJvlu7rmjIflrprmoLzlvI/nmoRyZW5kZXJEYXRhXHJcbiAgICAgICAgZGF0YS5jcmVhdGVGbGV4RGF0YSgwLCB0aGlzLnZlcnRpY2VzQ291bnQsIHRoaXMuaW5kaWNlc0NvdW50LCB2Zm10UG9zVXZDb2xvcik7XHJcblxyXG4gICAgICAgIC8vIOmhtueCueaVsOWbuuWumueahOaDheWGteS4i+e0ouW8leS4jeWPmOWMllxyXG4gICAgICAgIGxldCBpbmRpY2VzID0gZGF0YS5pRGF0YXNbMF07XHJcbiAgICAgICAgbGV0IGNvdW50ID0gaW5kaWNlcy5sZW5ndGggLyA2O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBpZHggPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgdmVydGV4dElEID0gaSAqIDQ7XHJcbiAgICAgICAgICAgIGluZGljZXNbaWR4KytdID0gdmVydGV4dElEO1xyXG4gICAgICAgICAgICBpbmRpY2VzW2lkeCsrXSA9IHZlcnRleHRJRCsxO1xyXG4gICAgICAgICAgICBpbmRpY2VzW2lkeCsrXSA9IHZlcnRleHRJRCsyO1xyXG4gICAgICAgICAgICBpbmRpY2VzW2lkeCsrXSA9IHZlcnRleHRJRCsxO1xyXG4gICAgICAgICAgICBpbmRpY2VzW2lkeCsrXSA9IHZlcnRleHRJRCszO1xyXG4gICAgICAgICAgICBpbmRpY2VzW2lkeCsrXSA9IHZlcnRleHRJRCsyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlUmVuZGVyRGF0YShjb21wOiBhbnkpe1xyXG4gICAgICAgIGlmKGNvbXApe1xyXG4gICAgICAgICAgICBsZXQgcG9pbnROdW06IG51bWJlciA9IGNvbXAuZ2V0VmVydE51bSgpO1xyXG4gICAgICAgICAgICBsZXQgc3BhY2VDbnQgPSBwb2ludE51bSAtIDE7XHJcbiAgICAgICAgICAgIHRoaXMudmVydHMubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgdGhpcy5xdWFkcy5sZW5ndGggPSAwO1xyXG5cclxuICAgICAgICAgICAgbGV0IG5vZGUgPSBjb21wLm5vZGU7XHJcbiAgICAgICAgICAgIGxldCBoZWlnaHQgPSBub2RlLmhlaWdodDtcclxuICAgICAgICAgICAgbGV0IHdpZHRoID0gbm9kZS53aWR0aDtcclxuXHJcbiAgICAgICAgICAgIC8vIOS4iuS4gOS4queCueeahOe6ueeQhuWdkOagh1xyXG4gICAgICAgICAgICBsZXQgbGFzdFUgPSAwO1xyXG4gICAgICAgICAgICAvLyDkuIvkuIDkuKrngrnnmoTnurnnkIblnZDmoIdcclxuICAgICAgICAgICAgbGV0IG5leHRVID0gMDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8v5Z2Q5qCHXHJcbiAgICAgICAgICAgIGxldCBzcGFjZVggPSB3aWR0aCAvIHNwYWNlQ250O1xyXG4gICAgICAgICAgICBsZXQgc3BhY2VVdiA9IDEgLyBzcGFjZUNudDtcclxuICAgICAgICAgICAgLy8g5bem5LiL6KeS55qE5Z2Q5qCHXHJcbiAgICAgICAgICAgIGxldCBwb3NYID0gLSB3aWR0aCAqIG5vZGUuYW5jaG9yWDtcclxuICAgICAgICAgICAgbGV0IHBvc1kgPSAtIGhlaWdodCAqIG5vZGUuYW5jaG9yWTtcclxuICAgICAgICAgICAgaWYoIWNjLnN5cy5pc05hdGl2ZSl7XHJcbiAgICAgICAgICAgICAgICBsZXQgd29ybGRQb3MgPSBjb21wLm5vZGUuY29udmVydFRvV29ybGRTcGFjZUFSKGNjLnYyKHBvc1gsIHBvc1kpKTtcclxuICAgICAgICAgICAgICAgIHBvc1ggPSB3b3JsZFBvcy54O1xyXG4gICAgICAgICAgICAgICAgcG9zWSA9IHdvcmxkUG9zLnk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMTsgaSA8IHBvaW50TnVtOyBpICsrKXtcclxuICAgICAgICAgICAgICAgIG5leHRVID0gbGFzdFUgKyBzcGFjZVV2O1xyXG4gICAgICAgICAgICAgICAgbGV0IGxiID0gdGhpcy52ZXJ0cy5wdXNoKHt4OiBwb3NYICsgKGkgLSAxKSAqIHNwYWNlWCwgeTogcG9zWSwgdTogbGFzdFUsIHY6IDEgfSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmIgPSB0aGlzLnZlcnRzLnB1c2goe3g6IHBvc1ggKyBpICogc3BhY2VYLCB5OiBwb3NZLCB1OiBuZXh0VSwgdjogMSB9KTtcclxuICAgICAgICAgICAgICAgIGxldCBsdCA9IHRoaXMudmVydHMucHVzaCh7eDogcG9zWCArIChpIC0gMSkgKiBzcGFjZVggLCB5OiBwb3NZICsgaGVpZ2h0LCB1OiBsYXN0VSwgdjogMCB9KTtcclxuICAgICAgICAgICAgICAgIGxldCBydCA9IHRoaXMudmVydHMucHVzaCh7eDogcG9zWCArIGkgKiBzcGFjZVgsIHk6IHBvc1kgKyBoZWlnaHQsIHU6IG5leHRVLCB2OiAwIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucXVhZHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbGI6IGxiIC0gMSxcclxuICAgICAgICAgICAgICAgICAgICByYjogcmIgLSAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGx0OiBsdCAtIDEsXHJcbiAgICAgICAgICAgICAgICAgICAgcnQgOiBydCAtIDEsXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgbGFzdFUgPSBuZXh0VTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihjYy5zeXMuaXNOYXRpdmUpe1xyXG4gICAgICAgICAgICAgICAgbGV0IHdoaXRlID0gY29tcC5ub2RlLmNvbG9yLl92YWw7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmVydGV4T2Zmc2V0ID0gMDtcclxuICAgICAgICAgICAgICAgIC8vIOWhq+WFhemhtueCuee8k+WGslxyXG4gICAgICAgICAgICAgICAgbGV0IHZidWYgPSB0aGlzLnJlbmRlckRhdGEudkRhdGFzWzBdO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMudmVydHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdmVydCA9IHRoaXMudmVydHNbaV1cclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldCsrXSA9IHZlcnQueDtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldCsrXSA9IHZlcnQueTtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldCsrXSA9IHZlcnQudTtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldCsrXSA9IHZlcnQudjtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldCsrXSA9IHdoaXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHZlcnRleE9mZnNldCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHZidWZbdmVydGV4T2Zmc2V0KytdID0gaXNGcm9udDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBsZXQgd2hpdGUgPSBjYy5Db2xvci5SRUQuX3ZhbCBcclxuIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZmlsbEJ1ZmZlcnMoY29tcDpjYy5SZW5kZXJDb21wb25lbnQsIHJlbmRlcmVyOmNjLnJlbmRlcmVyKXtcclxuICAgICAgICBpZiAodGhpcy52ZXJ0cy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGJ1ZmZlciA9IHJlbmRlcmVyLmdldEJ1ZmZlcignbWVzaCcsIHZmbXRQb3NVdkNvbG9yKVxyXG5cclxuICAgICAgICBsZXQgdmVydHMgPSB0aGlzLnZlcnRzXHJcbiAgICAgICAgbGV0IHZlcnRleENvdW50ID0gdmVydHMubGVuZ3RoXHJcbiAgICAgICAgbGV0IGluZGljZUNvdW50ID0gdGhpcy5xdWFkcy5sZW5ndGggKiA2XHJcbiAgICAgICAgLy8g6YCa6L+H6K6+5a6a55qE6aG254K55pWw6YeP5Y+K6aG254K557Si5byV5pWw6YeP6I635Y+WIGJ1ZmZlciDnmoTmlbDmja7nqbrpl7RcclxuICAgICAgICBsZXQgb2Zmc2V0SW5mbyA9IGJ1ZmZlci5yZXF1ZXN0KHZlcnRleENvdW50LCBpbmRpY2VDb3VudCk7XHJcblxyXG4gICAgICAgIGxldCB2YnVmID0gYnVmZmVyLl92RGF0YSAvL3Bvc2l0b24vdXZcclxuICAgICAgICBsZXQgaWJ1ZiA9IGJ1ZmZlci5faURhdGEgLy9pbmRleCBcclxuICAgICAgICBsZXQgdWludGJ1ZiA9IGJ1ZmZlci5fdWludFZEYXRhIC8vIGNvbG9yc1xyXG5cclxuICAgICAgICBsZXQgdmVydGV4T2Zmc2V0ID0gb2Zmc2V0SW5mby5ieXRlT2Zmc2V0ID4+IDJcclxuICAgICAgICBsZXQgaW5kaWNlT2Zmc2V0ID0gb2Zmc2V0SW5mby5pbmRpY2VPZmZzZXRcclxuICAgICAgICBsZXQgdmVydGV4SWQgPSBvZmZzZXRJbmZvLnZlcnRleE9mZnNldFxyXG4gICAgICAgIGxldCB3aGl0ZSA9IGNjLkNvbG9yLldISVRFLl92YWxcclxuICAgICAgICAvLyDloavlhYXpobbngrnnvJPlhrJcclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdmVydHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IHZlcnQgPSB2ZXJ0c1tpXVxyXG4gICAgICAgICAgICAvLyBsZXQgaXNGaXJzdFZlcnQgPSBpICUgMiA9PT0gMFxyXG4gICAgICAgICAgICAvLyBsZXQgZmlyc3RWZXJ0ID0gaXNGaXJzdFZlcnQgPyB2ZXJ0IDogdmVydHNbaSAtIDFdXHJcbiAgICAgICAgICAgIC8vIGxldCBzZWNvbmRWZXJ0ID0gaXNGaXJzdFZlcnQgPyB2ZXJ0c1tpICsgMV0gOiB2ZXJ0XHJcbiAgICAgICAgICAgIC8vIC8vIOiuoeeul+W9k+WJjeWwj+efqeW9ouaYr+ato+mdoui/mOaYr+iDjOmdolxyXG4gICAgICAgICAgICAvLyBsZXQgaXNGcm9udCA9IGZpcnN0VmVydC54IDwgc2Vjb25kVmVydC54ID8gMS4wIDogMC4wXHJcbiAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0KytdID0gdmVydC54O1xyXG4gICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldCsrXSA9IHZlcnQueTtcclxuICAgICAgICAgICAgdmJ1Zlt2ZXJ0ZXhPZmZzZXQrK10gPSB2ZXJ0LnU7XHJcbiAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0KytdID0gdmVydC52O1xyXG4gICAgICAgICAgICB1aW50YnVmW3ZlcnRleE9mZnNldCsrXSA9IHdoaXRlO1xyXG4gICAgICAgICAgICAvLyB2YnVmW3ZlcnRleE9mZnNldCsrXSA9IGlzRnJvbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWhq+WFhee0ouW8lee8k+WGslxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLnF1YWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBxdWFkID0gdGhpcy5xdWFkc1tpXVxyXG4gICAgICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgcXVhZC5sYlxyXG4gICAgICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgcXVhZC5yYlxyXG4gICAgICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgcXVhZC5sdFxyXG5cclxuICAgICAgICAgICAgaWJ1ZltpbmRpY2VPZmZzZXQrK10gPSB2ZXJ0ZXhJZCArIHF1YWQucmJcclxuICAgICAgICAgICAgaWJ1ZltpbmRpY2VPZmZzZXQrK10gPSB2ZXJ0ZXhJZCArIHF1YWQucnRcclxuICAgICAgICAgICAgaWJ1ZltpbmRpY2VPZmZzZXQrK10gPSB2ZXJ0ZXhJZCArIHF1YWQubHRcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19