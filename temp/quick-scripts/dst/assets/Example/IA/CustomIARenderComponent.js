
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Example/IA/CustomIARenderComponent.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '94208NQdWlDGaBbrhEU1DDg', 'CustomIARenderComponent');
// Example/IA/CustomIARenderComponent.ts

Object.defineProperty(exports, "__esModule", { value: true });
var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
var CustomIAAssembler_1 = require("./CustomIAAssembler");
var CustomIARenderComponent = /** @class */ (function (_super) {
    __extends(CustomIARenderComponent, _super);
    function CustomIARenderComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._texture = null;
        _this.uv = [];
        _this.local = [];
        _this.posOffset = 0;
        _this.max = 100;
        _this.direction = 1;
        _this.speed = 10;
        return _this;
    }
    Object.defineProperty(CustomIARenderComponent.prototype, "texture", {
        get: function () {
            return this._texture;
        },
        set: function (val) {
            if (this._texture !== val) {
                this._texture = val;
                this.applyTexture();
            }
        },
        enumerable: false,
        configurable: true
    });
    CustomIARenderComponent.prototype.onEnable = function () {
        _super.prototype.onEnable.call(this);
        this._activateMaterial();
        this.initVertexData();
    };
    //override
    CustomIARenderComponent.prototype._resetAssembler = function () {
        this.setVertsDirty(true);
        this._assembler = new CustomIAAssembler_1.default();
        this._assembler.init(this);
    };
    //override
    CustomIARenderComponent.prototype._activateMaterial = function () {
        var material = this.sharedMaterials[0];
        if (!material) {
            this.disableRender();
            return;
        }
        material = cc.Material.getInstantiatedMaterial(material, this);
        material.setProperty("texture", this.texture);
        this.setMaterial(0, material);
        this.markForRender(true);
    };
    CustomIARenderComponent.prototype.applyTexture = function () {
        var material = this.getMaterial(0);
        if (!material) {
            return;
        }
        material.setProperty("texture", this.texture);
    };
    CustomIARenderComponent.prototype.initVertexData = function () {
        var buffer = this._assembler.getBuffer();
        buffer.reset();
        buffer.request(4, 6);
        this.fillUV(buffer);
        this.fillIndices(buffer);
        this.fillVertex(buffer);
        buffer.uploadData();
        this._assembler._ia._count = 6;
    };
    CustomIARenderComponent.prototype.update = function (dt) {
        if (!this.getMaterial(0)) {
            return;
        }
        this.direction = this.posOffset >= this.max ? -1 : this.direction;
        this.direction = this.posOffset <= 0 ? 1 : this.direction;
        var step = dt * this.direction * this.speed;
        this.posOffset = this.posOffset + step;
        var buffer = this._assembler.getBuffer();
        var vbuf = buffer._vData;
        vbuf[0] += step;
        vbuf[15] -= step;
        buffer._vb.update(0, vbuf);
    };
    CustomIARenderComponent.prototype.fillUV = function (buffer) {
        var l = 0, r = 1, b = 1, t = 0;
        var vbuf = buffer._vData;
        vbuf[2] = l;
        vbuf[3] = b;
        vbuf[7] = r;
        vbuf[8] = b;
        vbuf[12] = l;
        vbuf[13] = t;
        vbuf[17] = r;
        vbuf[18] = t;
    };
    CustomIARenderComponent.prototype.fillIndices = function (buffer) {
        var iData = buffer._iData;
        iData[0] = 0;
        iData[1] = 1;
        iData[2] = 2;
        iData[3] = 1;
        iData[4] = 3;
        iData[5] = 2;
        var indicesData = new Uint16Array(iData.buffer, 0, iData.length);
        buffer._ib.update(0, indicesData);
    };
    CustomIARenderComponent.prototype.fillVertex = function (buffer) {
        var uintbuf = buffer._uintVData;
        var node = this.node, cw = node.width, ch = node.height, appx = node.anchorX * cw, appy = node.anchorY * ch;
        var l = -appx, b = -appy, r = cw - appx, t = ch - appy;
        var local = this.local;
        local[0] = l;
        local[1] = b;
        local[2] = r;
        local[3] = t;
        // color
        uintbuf[4] = this.node.color._val;
        uintbuf[9] = this.node.color._val;
        uintbuf[14] = this.node.color._val;
        uintbuf[19] = this.node.color._val;
        this.updateWorldVerts(buffer);
    };
    CustomIARenderComponent.prototype.updateWorldVerts = function (buffer) {
        this.node._updateWorldMatrix();
        var vbuf = buffer._vData;
        var local = this.local;
        var matrix = this.node._worldMatrix;
        var matrixm = matrix.m, a = matrixm[0], b = matrixm[1], c = matrixm[4], d = matrixm[5], tx = matrixm[12], ty = matrixm[13];
        var vl = local[0], vr = local[2], vb = local[1], vt = local[3];
        var justTranslate = a === 1 && b === 0 && c === 0 && d === 1;
        if (justTranslate) {
            // left bottom
            vbuf[0] = vl + tx;
            vbuf[1] = vb + ty;
            // right bottom
            vbuf[5] = vr + tx;
            vbuf[6] = vb + ty;
            // left top
            vbuf[10] = vl + tx;
            vbuf[11] = vt + ty;
            // right top
            vbuf[15] = vr + tx;
            vbuf[16] = vt + ty;
        }
        else {
            var al = a * vl, ar = a * vr, bl = b * vl, br = b * vr, cb = c * vb, ct = c * vt, db = d * vb, dt = d * vt;
            // left bottom
            vbuf[0] = al + cb + tx;
            vbuf[1] = bl + db + ty;
            // right bottom
            vbuf[5] = ar + cb + tx;
            vbuf[6] = br + db + ty;
            // left top
            vbuf[10] = al + ct + tx;
            vbuf[11] = bl + dt + ty;
            // right top
            vbuf[15] = ar + ct + tx;
            vbuf[16] = br + dt + ty;
        }
    };
    __decorate([
        property
    ], CustomIARenderComponent.prototype, "_texture", void 0);
    __decorate([
        property({
            type: cc.Texture2D
        })
    ], CustomIARenderComponent.prototype, "texture", null);
    CustomIARenderComponent = __decorate([
        ccclass
    ], CustomIARenderComponent);
    return CustomIARenderComponent;
}(cc.RenderComponent));
exports.default = CustomIARenderComponent;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcRXhhbXBsZVxcSUFcXEN1c3RvbUlBUmVuZGVyQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBTSxJQUFBLEtBQXNCLEVBQUUsQ0FBQyxVQUFVLEVBQWxDLE9BQU8sYUFBQSxFQUFFLFFBQVEsY0FBaUIsQ0FBQztBQUMxQyx5REFBbUQ7QUFHbkQ7SUFBcUQsMkNBQWtCO0lBQXZFO1FBQUEscUVBcU1DO1FBbk1HLGNBQVEsR0FBRyxJQUFJLENBQUM7UUFnQmhCLFFBQUUsR0FBRyxFQUFFLENBQUM7UUFDUixXQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ1gsZUFBUyxHQUFHLENBQUMsQ0FBQztRQUNkLFNBQUcsR0FBRyxHQUFHLENBQUM7UUFDVixlQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsV0FBSyxHQUFHLEVBQUUsQ0FBQzs7SUE4S2YsQ0FBQztJQTlMRyxzQkFBSSw0Q0FBTzthQUFYO1lBQ0ksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3pCLENBQUM7YUFFRCxVQUFhLEdBQUc7WUFDWixJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssR0FBRyxFQUFFO2dCQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQztnQkFDcEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO2FBQ3ZCO1FBQ0wsQ0FBQzs7O09BUEE7SUFlRCwwQ0FBUSxHQUFSO1FBQ0ksaUJBQU0sUUFBUSxXQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFFekIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRCxVQUFVO0lBQ1YsaURBQWUsR0FBZjtRQUNJLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLDJCQUFpQixFQUFFLENBQUM7UUFDMUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMs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LElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUM7U0FDM0I7SUFDTCxDQUFDO0lBbE1EO1FBREMsUUFBUTs2REFDTztJQUtoQjtRQUhDLFFBQVEsQ0FBQztZQUNOLElBQUksRUFBRSxFQUFFLENBQUMsU0FBUztTQUNyQixDQUFDOzBEQUdEO0lBVGdCLHVCQUF1QjtRQUQzQyxPQUFPO09BQ2EsdUJBQXVCLENBcU0zQztJQUFELDhCQUFDO0NBck1ELEFBcU1DLENBck1vRCxFQUFFLENBQUMsZUFBZSxHQXFNdEU7a0JBck1vQix1QkFBdUIiLCJmaWxlIjoiIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7Y2NjbGFzcywgcHJvcGVydHl9ID0gY2MuX2RlY29yYXRvcjtcbmltcG9ydCBDdXN0b21JQUFzc2VtYmxlciBmcm9tICcuL0N1c3RvbUlBQXNzZW1ibGVyJ1xuXG5AY2NjbGFzc1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3VzdG9tSUFSZW5kZXJDb21wb25lbnQgZXh0ZW5kcyBjYy5SZW5kZXJDb21wb25lbnQge1xuICAgIEBwcm9wZXJ0eVxuICAgIF90ZXh0dXJlID0gbnVsbDtcbiAgICBcbiAgICBAcHJvcGVydHkoe1xuICAgICAgICB0eXBlOiBjYy5UZXh0dXJlMkRcbiAgICB9KVxuICAgIGdldCB0ZXh0dXJlICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmU7XG4gICAgfVxuXG4gICAgc2V0IHRleHR1cmUgKHZhbCkge1xuICAgICAgICBpZiAodGhpcy5fdGV4dHVyZSAhPT0gdmFsKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXh0dXJlID0gdmFsO1xuICAgICAgICAgICAgdGhpcy5hcHBseVRleHR1cmUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHV2ID0gW107XG4gICAgbG9jYWwgPSBbXTtcbiAgICBwb3NPZmZzZXQgPSAwO1xuICAgIG1heCA9IDEwMDtcbiAgICBkaXJlY3Rpb24gPSAxO1xuICAgIHNwZWVkID0gMTA7XG4gICAgb25FbmFibGUgKCkge1xuICAgICAgICBzdXBlci5vbkVuYWJsZSgpO1xuICAgICAgICB0aGlzLl9hY3RpdmF0ZU1hdGVyaWFsKCk7XG5cbiAgICAgICAgdGhpcy5pbml0VmVydGV4RGF0YSgpO1xuICAgIH1cblxuICAgIC8vb3ZlcnJpZGVcbiAgICBfcmVzZXRBc3NlbWJsZXIgKCkge1xuICAgICAgICB0aGlzLnNldFZlcnRzRGlydHkodHJ1ZSk7XG4gICAgICAgIHRoaXMuX2Fzc2VtYmxlciA9IG5ldyBDdXN0b21JQUFzc2VtYmxlcigpO1xuICAgICAgICB0aGlzLl9hc3NlbWJsZXIuaW5pdCh0aGlzKTtcbiAgICB9XG5cbiAgICAvL292ZXJyaWRlXG4gICAgX2FjdGl2YXRlTWF0ZXJpYWwgKCkge1xuICAgICAgICBsZXQgbWF0ZXJpYWwgPSB0aGlzLnNoYXJlZE1hdGVyaWFsc1swXTtcbiAgICAgICAgaWYgKCFtYXRlcmlhbCkge1xuICAgICAgICAgICAgdGhpcy5kaXNhYmxlUmVuZGVyKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIG1hdGVyaWFsID0gY2MuTWF0ZXJpYWwuZ2V0SW5zdGFudGlhdGVkTWF0ZXJpYWwobWF0ZXJpYWwsIHRoaXMpO1xuICAgICAgICBtYXRlcmlhbC5zZXRQcm9wZXJ0eShcInRleHR1cmVcIiwgdGhpcy50ZXh0dXJlKTtcbiAgICAgICAgdGhpcy5zZXRNYXRlcmlhbCgwLCBtYXRlcmlhbCk7XG4gICAgICAgIHRoaXMubWFya0ZvclJlbmRlcih0cnVlKTtcbiAgICB9XG5cbiAgICBhcHBseVRleHR1cmUgKCkge1xuICAgICAgICBsZXQgbWF0ZXJpYWwgPSB0aGlzLmdldE1hdGVyaWFsKDApO1xuICAgICAgICBpZiAoIW1hdGVyaWFsKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIG1hdGVyaWFsLnNldFByb3BlcnR5KFwidGV4dHVyZVwiLCB0aGlzLnRleHR1cmUpO1xuICAgIH1cblxuICAgIGluaXRWZXJ0ZXhEYXRhICgpIHtcbiAgICAgICAgbGV0IGJ1ZmZlciA9IHRoaXMuX2Fzc2VtYmxlci5nZXRCdWZmZXIoKTtcbiAgICAgICAgYnVmZmVyLnJlc2V0KCk7XG4gICAgICAgIGJ1ZmZlci5yZXF1ZXN0KDQsIDYpO1xuXG4gICAgICAgIHRoaXMuZmlsbFVWKGJ1ZmZlcik7XG4gICAgICAgIHRoaXMuZmlsbEluZGljZXMoYnVmZmVyKTtcbiAgICAgICAgdGhpcy5maWxsVmVydGV4KGJ1ZmZlcik7XG5cbiAgICAgICAgYnVmZmVyLnVwbG9hZERhdGEoKTtcblxuICAgICAgICB0aGlzLl9hc3NlbWJsZXIuX2lhLl9jb3VudCA9IDY7XG4gICAgfVxuXG4gICAgdXBkYXRlIChkdCkge1xuICAgICAgICBpZiAoIXRoaXMuZ2V0TWF0ZXJpYWwoMCkpIHsgXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gdGhpcy5wb3NPZmZzZXQgPj0gdGhpcy5tYXggPyAtMSA6IHRoaXMuZGlyZWN0aW9uO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMucG9zT2Zmc2V0IDw9IDAgPyAxIDogdGhpcy5kaXJlY3Rpb247XG4gICAgICAgIGxldCBzdGVwID0gZHQgKiB0aGlzLmRpcmVjdGlvbiAqIHRoaXMuc3BlZWQ7XG4gICAgICAgIHRoaXMucG9zT2Zmc2V0ID0gdGhpcy5wb3NPZmZzZXQgKyBzdGVwO1xuXG4gICAgICAgIGxldCBidWZmZXIgPSB0aGlzLl9hc3NlbWJsZXIuZ2V0QnVmZmVyKCk7XG4gICAgICAgIGxldCB2YnVmID0gYnVmZmVyLl92RGF0YTtcbiAgXG4gICAgICAgIHZidWZbMF0gKz0gc3RlcDtcbiAgICAgICAgdmJ1ZlsxNV0gLT0gc3RlcDtcblxuICAgICAgICBidWZmZXIuX3ZiLnVwZGF0ZSgwLCB2YnVmKTtcbiAgICB9XG5cbiAgICBmaWxsVVYgKGJ1ZmZlcikge1xuICAgICAgICBsZXQgbCA9IDAsIHIgPSAxLCBiID0gMSwgdCA9IDA7XG4gICAgICAgIGxldCB2YnVmID0gYnVmZmVyLl92RGF0YTtcblxuICAgICAgICB2YnVmWzJdID0gbDtcbiAgICAgICAgdmJ1ZlszXSA9IGI7XG4gICAgICAgIHZidWZbN10gPSByO1xuICAgICAgICB2YnVmWzhdID0gYjtcbiAgICAgICAgdmJ1ZlsxMl0gPSBsO1xuICAgICAgICB2YnVmWzEzXSA9IHQ7XG4gICAgICAgIHZidWZbMTddID0gcjtcbiAgICAgICAgdmJ1ZlsxOF0gPSB0O1xuICAgIH1cblxuICAgIGZpbGxJbmRpY2VzIChidWZmZXIpIHtcbiAgICAgICAgbGV0IGlEYXRhID0gYnVmZmVyLl9pRGF0YTtcbiAgICAgICAgaURhdGFbMF0gPSAwO1xuICAgICAgICBpRGF0YVsxXSA9IDE7XG4gICAgICAgIGlEYXRhWzJdID0gMjtcbiAgICAgICAgaURhdGFbM10gPSAxO1xuICAgICAgICBpRGF0YVs0XSA9IDM7XG4gICAgICAgIGlEYXRhWzVdID0gMjtcblxuICAgICAgICBsZXQgaW5kaWNlc0RhdGEgPSBuZXcgVWludDE2QXJyYXkoaURhdGEuYnVmZmVyLCAwLCBpRGF0YS5sZW5ndGgpO1xuICAgICAgICBidWZmZXIuX2liLnVwZGF0ZSgwLCBpbmRpY2VzRGF0YSk7XG4gICAgfVxuXG4gICAgZmlsbFZlcnRleCAoYnVmZmVyKSB7XG4gICAgICAgIGxldCB1aW50YnVmID0gYnVmZmVyLl91aW50VkRhdGE7XG4gICAgICAgIFxuICAgICAgICBsZXQgbm9kZSA9IHRoaXMubm9kZSxcbiAgICAgICAgY3cgPSBub2RlLndpZHRoLCBjaCA9IG5vZGUuaGVpZ2h0LFxuICAgICAgICBhcHB4ID0gbm9kZS5hbmNob3JYICogY3csIGFwcHkgPSBub2RlLmFuY2hvclkgKiBjaDtcblxuICAgICAgICBsZXQgbCA9IC0gYXBweCxcbiAgICAgICAgICAgIGIgPSAtIGFwcHksXG4gICAgICAgICAgICByID0gY3cgLSBhcHB4LFxuICAgICAgICAgICAgdCA9IGNoIC0gYXBweTtcblxuICAgICAgICBsZXQgbG9jYWwgPSB0aGlzLmxvY2FsO1xuICAgICAgICBsb2NhbFswXSA9IGw7XG4gICAgICAgIGxvY2FsWzFdID0gYjtcbiAgICAgICAgbG9jYWxbMl0gPSByO1xuICAgICAgICBsb2NhbFszXSA9IHQ7XG5cbiAgICAgICAgLy8gY29sb3JcbiAgICAgICAgdWludGJ1Zls0XSA9IHRoaXMubm9kZS5jb2xvci5fdmFsO1xuICAgICAgICB1aW50YnVmWzldID0gdGhpcy5ub2RlLmNvbG9yLl92YWw7XG4gICAgICAgIHVpbnRidWZbMTRdID0gdGhpcy5ub2RlLmNvbG9yLl92YWw7XG4gICAgICAgIHVpbnRidWZbMTldID0gdGhpcy5ub2RlLmNvbG9yLl92YWw7XG5cbiAgICAgICAgdGhpcy51cGRhdGVXb3JsZFZlcnRzKGJ1ZmZlcik7XG4gICAgfVxuXG4gICAgdXBkYXRlV29ybGRWZXJ0cyAoYnVmZmVyKSB7XG5cbiAgICAgICAgdGhpcy5ub2RlLl91cGRhdGVXb3JsZE1hdHJpeCgpO1xuICAgICAgICBcbiAgICAgICAgbGV0IHZidWYgPSBidWZmZXIuX3ZEYXRhO1xuICAgICAgICBsZXQgbG9jYWwgPSB0aGlzLmxvY2FsO1xuICAgICAgICBsZXQgbWF0cml4ID0gdGhpcy5ub2RlLl93b3JsZE1hdHJpeDtcbiAgICAgICAgbGV0IG1hdHJpeG0gPSBtYXRyaXgubSxcbiAgICAgICAgICAgIGEgPSBtYXRyaXhtWzBdLCBiID0gbWF0cml4bVsxXSwgYyA9IG1hdHJpeG1bNF0sIGQgPSBtYXRyaXhtWzVdLFxuICAgICAgICAgICAgdHggPSBtYXRyaXhtWzEyXSwgdHkgPSBtYXRyaXhtWzEzXTtcblxuICAgICAgICBsZXQgdmwgPSBsb2NhbFswXSwgdnIgPSBsb2NhbFsyXSxcbiAgICAgICAgICAgIHZiID0gbG9jYWxbMV0sIHZ0ID0gbG9jYWxbM107XG4gICAgICAgIFxuICAgICAgICBsZXQganVzdFRyYW5zbGF0ZSA9IGEgPT09IDEgJiYgYiA9PT0gMCAmJiBjID09PSAwICYmIGQgPT09IDE7XG5cbiAgICAgICAgaWYgKGp1c3RUcmFuc2xhdGUpIHtcbiAgICAgICAgICAgIC8vIGxlZnQgYm90dG9tXG4gICAgICAgICAgICB2YnVmWzBdID0gdmwgKyB0eDtcbiAgICAgICAgICAgIHZidWZbMV0gPSB2YiArIHR5O1xuICAgICAgICAgICAgLy8gcmlnaHQgYm90dG9tXG4gICAgICAgICAgICB2YnVmWzVdID0gdnIgKyB0eCA7XG4gICAgICAgICAgICB2YnVmWzZdID0gdmIgKyB0eTtcbiAgICAgICAgICAgIC8vIGxlZnQgdG9wXG4gICAgICAgICAgICB2YnVmWzEwXSA9IHZsICsgdHg7XG4gICAgICAgICAgICB2YnVmWzExXSA9IHZ0ICsgdHk7XG4gICAgICAgICAgICAvLyByaWdodCB0b3BcbiAgICAgICAgICAgIHZidWZbMTVdID0gdnIgKyB0eDtcbiAgICAgICAgICAgIHZidWZbMTZdID0gdnQgKyB0eTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBhbCA9IGEgKiB2bCwgYXIgPSBhICogdnIsXG4gICAgICAgICAgICBibCA9IGIgKiB2bCwgYnIgPSBiICogdnIsXG4gICAgICAgICAgICBjYiA9IGMgKiB2YiwgY3QgPSBjICogdnQsXG4gICAgICAgICAgICBkYiA9IGQgKiB2YiwgZHQgPSBkICogdnQ7XG5cbiAgICAgICAgICAgIC8vIGxlZnQgYm90dG9tXG4gICAgICAgICAgICB2YnVmWzBdID0gYWwgKyBjYiArIHR4O1xuICAgICAgICAgICAgdmJ1ZlsxXSA9IGJsICsgZGIgKyB0eTtcbiAgICAgICAgICAgIC8vIHJpZ2h0IGJvdHRvbVxuICAgICAgICAgICAgdmJ1Zls1XSA9IGFyICsgY2IgKyB0eDtcbiAgICAgICAgICAgIHZidWZbNl0gPSBiciArIGRiICsgdHk7XG4gICAgICAgICAgICAvLyBsZWZ0IHRvcFxuICAgICAgICAgICAgdmJ1ZlsxMF0gPSBhbCArIGN0ICsgdHg7XG4gICAgICAgICAgICB2YnVmWzExXSA9IGJsICsgZHQgKyB0eTtcbiAgICAgICAgICAgIC8vIHJpZ2h0IHRvcFxuICAgICAgICAgICAgdmJ1ZlsxNV0gPSBhciArIGN0ICsgdHg7XG4gICAgICAgICAgICB2YnVmWzE2XSA9IGJyICsgZHQgKyB0eTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==